### [:diamond_shape_with_a_dot_inside:](#toc) <a name='3'>Управление пользователями</a>

_**Задача:** Создать новую учетную запись пользователя с личной группой и домашний каталог с набором файлов по умолчанию, таких как `.bashrc`, `.profile`, `.bash_history`, и любыми другими необходимыми файлами._

В большинстве дистрибутивов Linux для этой цели имеется команда `useradd`, которую можно настроить под свои требования. Конфигурация по умолчанию различается в разных дистрибутивах, поэтому самый простой способ узнать используемые настройки — создать новую пробную учетную запись:

```ruby
# Создать пользователя
sudo useradd test1

# Проверяем созданного пользователя
id test1
sudo ls -a /home/test1/

# Устанавливаем пароль
sudo passwd test1

# Заставить пользователя сменить пароль при первом входе в систему
sudo passwd -e test1

# Создать пользователю домашний каталог (m) и добавить в личную группу (U)
sudo useradd -mU test2

# -G, --groups — добавляет пользователя в несколько дополнительных групп
sudo useradd -G group1,group2,group3 test1

# -c, --comment — принимает любую текстовую строку и сохраняет ее как полное имя пользователя, комментарий или описание
sudo useradd -G group1,group2,group3 -c 'Test 1,,,,' test1
```


```ruby
# Дополнительная информация
man 8 useradd
man 5 login.defs

/etc/default/useradd
/etc/skel
/etc/login/defs
```


<br>

_**Задача:** Создание системной учетной записи с помощью команды `useradd`._


Параметр `-r` создает системного пользователя с реальным UID из диапазона, предназначенного для системных пользователей, а параметр `-s` задает оболочку входа `/bin/false` — команду, которая ничего не делает и не позволяет выполнить вход в систему с именем этого пользователя.

```ruby
# создание нового системного пользователя без домашнего каталога
sudo useradd -rs /bin/false service1
```


<br>

_**Задача:** Изменение настроек по умолчанию для команды `useradd`._

Настройки команды `useradd` разбросаны по множеству конфигурационных файлов, таких как `/etc/default/useradd`, `/etc/login.defs` и файлы в каталоге `/etc/skel`.

`/etc/login.defs` — конфигурационный файл, который устанавливает параметры по умолчанию для входа в систему, политик паролей и создания учётной записи пользователя. С помощью этого файла можно настроить, например, какой минимальный и максимальный id нужно выдавать, что делать с папкой пользователя при удалении, количество попыток входа и таймаут.

`/etc/default/useradd` — конфигурационный файл для команды `useradd` в системах Linux/Unix. Он определяет значения по умолчанию при создании новых учётных записей пользователей, такие как домашний каталог, оболочка и группа пользователя по умолчанию.

`/etc/skel` — каталог-шаблон в системе Linux, содержащий файлы и настройки, которые будут скопированы в домашние каталоги новых пользователей при их создании.

```ruby
sudo cat /etc/default/useradd
```
![image](https://github.com/user-attachments/assets/e0e5cadf-f70b-4f64-8511-e9adf2515670)

```ruby
sudo ls -la /etc/skel
```
![image](https://github.com/user-attachments/assets/6e9895a5-1882-4f63-b6c2-be498c2fe649)


```ruby
# Дополнительная информация
man 8 useradd
man 5 login.defs

/etc/default/useradd
/etc/skel
/etc/login/defs

# Linux книга рецептов. Карла Шрёдер, стр. 143
```


<br>

_**Задача:** Настройка каталогов для документов, музыки, видео, изображений и загрузок._

Создание этих каталогов является функцией не команды `useradd`, а, скорее, инструмента управления пользовательскими каталогами X Desktop Group (XDG). Отдельные каталоги для документов, музыки, видео считаются специализированными, и соответствующие им настройки, применяемые по умолчанию ко всем пользователям, находятся в конфигурационном файле `/etc/xdg/userdirs.defaults`
 
Настройки представлены парами «`имя — значение`». Имена нельзя изменить. Значения — это каталоги, соответствующие именам, находящиеся в домашних каталогах пользователей. Например, имя `DOCUMENTS` отображается в каталог `/home/username/Documents`. Каталоги создаются автоматически для каждого нового пользователя при первом запуске графической среды рабочего стола. Вы можете закомментировать любые каталоги, чтобы исключить их создание, или изменить названия каталогов.

![image](https://github.com/user-attachments/assets/76466daf-1273-4a2d-89d8-07c70b5d958f)


Пользователи могут самостоятельно определять свои настройки в `~/.config/user-dirs.dirs`. Каталоги должны существовать до применения изменений.

![image](https://github.com/user-attachments/assets/51da3052-68ed-49eb-9dbc-7e68a6980d5e)

Внеся изменения и создав нужные каталоги, выполните команду xdg-user-dirsupdate, чтобы применить изменения:

![image](https://github.com/user-attachments/assets/bd60f9c0-adb6-434f-9cfd-5ff19de4db4d)

Восстановить настройки по умолчанию из `/etc/xdg/user-dirs.defaults` можно с помощью команды:

```ruby
xdg-user-dirs-update --force
```

Выйдите и войдите снова, чтобы убедиться, что ни один из ваших каталогов не был удален и не претерпел никаких изменений, кроме отображения специальных значков в диспетчере файлов.

В команде `xdg-user-dirs-update --set` можно использовать только имена, перечисленные в руководстве `man 5 user-dirs.default`

```ruby
# Дополнительная информация
man 5 user-dirs.defaults
man 1 xdg-user-dirs-update
man 5 user-dirs.conf
```


<br>

_**Задача:** Создание пользовательских и системных групп с помощью команды `groupadd`._

```ruby
# создаст новую группу пользователей musicians:
sudo groupadd musicians

# Для того, чтобы создать системную группу, команду groupadd следует вызвать с параметром -r:
sudo groupadd -r service1
```

Системные группы отличаются от групп пользователей-людей диапазонами GID. Они определены в `/etc/login.defs` и используются командами `groupadd` и `useradd`.

Эти настройки определяют диапазоны идентификаторов, доступных системному администратору. Все остальные диапазоны зарезервированы и управляются системой. `GID` автоматически выбираются с помощью команды `groupadd` в соответствии с диапазонами в `/etc/login.defs`. Задать свое значение `GID` позволяет параметр `-g`, при этом выбранный вами `GID` должен попадать в соответствующий диапазон и еще не использоваться.


<br>

_**Задача:** Добавление пользователей в группы с помощью команды `usermod`._

```ruby
# добавления пользователя Duchess в группу musicians
sudo usermod -aG musicians duchess

# cледующая команда добавит Duchess в несколько групп
# Параметр -a означает append («добавить в конец»), а -G — group («группа»).
sudo usermod -aG musicians,composers,stagehands duchess

# Альтернативное решение — отредактировать файл /etc/group
musicians:x:900:stash,madmax,duchess

# Если вы забудете параметр -a и укажете только -G, то все пользователи, прежде входившие в группу,
# будут исключены из нее. Это особенно чревато неприятностями при удалении пользователей из их группы sudo

# Дополнительная информация
man 8 usermod
```

















