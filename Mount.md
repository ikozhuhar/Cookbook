## Монтирование удаленной папки

`//192.168.2.32/DWH_Portal_Statistic /mnt/DWH_Portal_Statistic cifs credentials=/root/.smbclient,iocharset=utf8,file_mode=0777,dir_mode=0777,noperm,rw,vers=3.0 0 0`

Краткий ответ: Эта строка предназначена для автоматического подключения (монтирования) удаленной сетевой папки `//khd-fs01.mip.ru/Отчеты` к локальной файловой системе при загрузке компьютера. Папка будет доступна в директории `/shared_dir/Отчеты`.



### ✅ Детальный разбор по частям:

_Синтаксис строки в /etc/fstab следующий:_

```ruby
<источник> <точка_монтирования> <тип_файловой_системы> <опции> <дампирование> <проверка_при_загрузке>
mount -t cifs //192.168.2.32/DWH_Portal_Statistic /mnt/DWH_Portal_Statistic -o credentials=/root/.smbclient,iocharset=utf8,file_mode=0777,dir_mode=0777,noperm,rw
```

_Разберем каждую часть вашей строки:_


#### ✅ _1. Источник (Источник монтирования)_

`//khd-fs01.mip.ru/Отчеты` 
- Это путь к сетевому ресурсу (шаре) по протоколу SMB/CIFS, который используется в сетях Windows. 
- `khd-fs01.mip.ru` — это имя или адрес файлового сервера в сети. 
- `Отчеты` — это название общей папки (шары) на этом сервере.



#### ✅ _2. Точка монтирования (Куда монтируется)_

`/shared_dir/Отчеты` 
- Это путь в вашей локальной Linux-системе, куда будет "подключено" содержимое удаленной папки. 
- После успешного монтирования, зайдя в локальную папку /shared_dir/Отчеты, вы будете видеть файлы и папки, которые физически находятся на сервере khd-fs01.mip.ru.



#### ✅ _3. Тип файловой системы_

`cifs`
- Указывает ядру Linux, что для работы с этим сетевым ресурсом нужно использовать драйвер **CIFS** (Common Internet File System). 
- CIFS — это более современная версия протокола SMB (Server Message Block), используемого для общего доступа к файлам в сетях Windows. В современных системах эти термины часто взаимозаменяемы.



#### ✅ _4. Опции монтирования_

`credentials=/etc/samba/file_upload.cred,domain=MIP,file_mode=0777,dir_mode=0777`
- Это самая важная и информативная часть. Опции перечисляются через запятую. 
- `credentials=/etc/samba/file_upload.cred` указывает путь к файлу, в котором хранятся логин и пароль для доступа к сетевой папке. 
- Внутри файла `/etc/samba/file_upload.cred` должны быть строки:

```ruby
username=ваш_логин
password=ваш_пароль
```

- Это более безопасный способ, чем указывать пароль прямо в командной строке или в fstab.
- domain=MIP - Указывает домен Windows, в котором происходит аутентификация. Пользователь, указанный в файле учетных данных, будет искаться в домене MIP.
- `file_mode=0777, dir_mode=0777` - Эти опции определяют права доступа для файлов и директорий на стороне клиента (вашего Linux-компьютера) после монтирования.
- `0777` — это права в восьмеричном формате. Они означают: полный доступ для всех (владелец, группа и все остальные пользователи могут читать, записывать и исполнять файлы).
- **Важное замечание**: Эти права могут быть ограничены реальными правами доступа на сервере и правами на саму точку монтирования (/shared_dir/Отчеты).



#### ✅ _5. Дампирование (Резервное копирование)_

`0` 
- Указывает утилите dump (устаревший инструмент для резервного копирования), следует ли создавать резервные копии этой файловой системы.
- `0` означает, что резервное копирование для этой файловой системы не требуется.



#### ✅ _6. Проверка файловой системы при загрузке_

`0`

- Указывает утилите `fsck` (программа для проверки целостности файловой системы), нужно ли проверять эту файловую систему при загрузке.
- `0` означает, что проверка не требуется. Это стандартное значение для сетевых файловых систем (`CIFS`, `NFS`), так как их проверка на клиентской машине бессмысленна.



#### ✅ _Итог и что делает вся команда в целом:_

1. При загрузке операционной системы (или при выполнении команды mount -a) система автоматически:
2. Прочитает файл с учетными данными (/etc/samba/file_upload.cred).
3. Используя эти данные, подключится к серверу khd-fs01.mip.ru в домене MIP.
4. Получит доступ к общей папке Отчеты.
5. "Присоединит" содержимое этой папки в локальную директорию /shared_dir/Отчеты.
6. Установит права 0777 для всех создаваемых через это монтирование файлов и папок (в пределах локальной системы).

После этого любой пользователь и программа в системе смогут работать с файлами в `/shared_dir/Отчеты` так, как будто они находятся на локальном диске, хотя на самом деле все операции будут прозрачно перенаправляться на сетевой сервер.


#### ✅ _Troubleshooting_


1. Проверьте содержимое файла credentials. Убедитесь, что `/root/.smbclient` содержит:

```ruby
username=your_windows_username
password=your_windows_password
```

2. Права на файл с паролями:

```ruby
chmod 600 /root/.smbclient
```

3. Перед добавлением в fstab:

Протестируйте монтирование вручную:

```ruby
mkdir -p /mnt/DWH_Portal_Statistic
mount -t cifs //192.168.2.32/DWH_Portal_Statistic /mnt/DWH_Portal_Statistic -o credentials=/root/.smbclient,iocharset=utf8,file_mode=0777,dir_mode=0777,noperm,rw,vers=3.0
```

4. Итоговый fstab:

```ruby
//192.168.2.32/DWH_Portal_Statistic /mnt/DWH_Portal_Statistic cifs credentials=/root/.smbclient,iocharset=utf8,file_mode=0777,dir_mode=0777,noperm,rw,vers=3.0 0 0
```

5. После добавления в /etc/fstab проверьте:

```ruby
mount -a
mount | grep DWH_Portal_Statistic
```

6. Проверим точку монтирования

```ruby
ping 192.168.2.32
nc -zv 192.168.2.32 445
df -h | grep DWH_Portal_Statistic
mount | grep DWH_Portal_Statistic
```

7. Проверим список доступных шаров
```ruby
smbclient -L 192.168.2.32 -A /root/.smbclient
```

8. Попробуем подключиться через smbclient
```ruby
# Подключимся напрямую к шаре
smbclient //192.168.2.32/DWH_Portal_Statistic -A /root/.smbclient

# Внутри smbclient выполните:
ls
exit
```

9. Проверим права доступа пользователя

```ruby
# Попробуем создать тестовый файл
touch /mnt/DWH_Portal_Statistic/test_file.txt
echo "test" > /mnt/DWH_Portal_Statistic/test_file.txt
# Проверим, появился ли он в Windows-шаре
```

10. Проверим логи

```ruby
# Посмотрим системные логи
dmesg | grep -i cifs
sudo journalctl -u systemd-fstab-generator | grep -i cifs

# Логи CIFS
cat /var/log/kern.log | grep -i cifs
```

11. Альтернативные варианты монтирования

_Если проблема сохраняется, попробуйте:_

```ruby
# Размонтируем сначала
umount /mnt/DWH_Portal_Statistic

# Монтируем с дополнительными опциями для отладки
mount -t cifs //192.168.2.32/DWH_Portal_Statistic /mnt/DWH_Portal_Statistic -o credentials=/root/.smbclient,iocharset=utf8,vers=2.1,debug
```


#### ✅ _Troubleshooting Summary_

```ruby
ping 192.168.2.32
nc -zv 192.168.2.32 445
df -h | grep DWH_Portal_Statistic
mount | grep DWH_Portal_Statistic

# Проверить другие доступные шары на сервере. Это покажет все доступные шары на этом сервере.
smbclient -L 192.168.2.32 -A /root/.smbclient

# Создаем тестовый файл через монтирование
echo "test file from linux $(date)" | sudo tee /mnt/DWH_Portal_Statistic/test_linux.txt

# Проверяем через smbclient
smbclient //192.168.2.32/DWH_Portal_Statistic -A /root/.smbclient -c "ls"

# Посмотрим все шары на сервере
smbclient -L 192.168.2.32 -A /root/.smbclient

# Ищем шары с похожими именами
smbclient -L 192.168.2.32 -A /root/.smbclient | grep -i portal
smbclient -L 192.168.2.32 -A /root/.smbclient | grep -i dwh
```


