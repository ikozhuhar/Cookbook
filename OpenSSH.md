## Безопасный удаленный доступ с OpenSSH

OpenSSH — популярный инструмент для безопасного удаленного администрирования. Он шифрует весь трафик, передаваемый во время сеанса, и гарантирует целостность передачи данных. В данной главе вы узнаете, как настроить доступ к удаленным хостам через SSH, управлять своими ключами шифрования, настроить свои учетные данные на нескольких удаленных хостах, настроить приглашение Bash, чтобы отличать сеансы SSH, и многое другое.

OpenSSH — это набор утилит для передачи данных по сети:

| Компонент | Роль |
| ------- | ----------- |
| `sshd` | демон сервера OpenSSH |
| `ssh` | сокращенно от secure shell («безопасная оболочка»), но на самом деле не включает оболочку, а обеспечивает безопасный канал связи с командной оболочкой в удаленной системе |
| `scp` | сокращенно от secure copy («безопасное копирование»), предназначена для шифрованной передачи файлов |
| `sftp` | («протокол безопасной передачи файлов»), обеспечивает доступ к файлам |
| `ssh-copy-id` | замечательная маленькая программа для сохранения вашего открытого ключа в файле `authorized_keys` на удаленном сервере SSH |
| `ssh-keyscan` | отыскивает и собирает открытые ключи хостов в сети, избавляя от необходимости искать их вручную |
| `ssh-keygen` | генерирует ключи аутентификации и управляет ими |
| `ssh-add` | добавляет вашу идентификационную информацию в настройки агента аутентификации ssh-agent |

В этой главе вы познакомитесь с `ssh`, `sshd`, `ssh-copy-id`, `ssh-keygen` и двумя полезными утилитами: `sshfs` и `ssh-agent`

```ruby
# Конфигурационный файл
/etc/ssh/sshd_config

# Проверка правильности атрибутов файлов и домашних каталогов пользователей, прежде чем принимать от них запросы на подключение:
StrictModes yes

# Указать с какого адреса принимать запросы
ListenAddress 192.168.10.15
```


Можно назначить нестандартные порты для приема соединений сервером `sshd`. Используйте только порты выше 1024 и загляните в `/etc/services`, чтобы выбрать неиспользуемые порты, затем добавьте новые порты в `/etc/services`:

```ruby
sshd 2022
sshd 2023
```

# После этого добавьте их в файл /etc/ssh/sshd_config:
Port 2022
Port 2023
```

Можно разрешить доступ только указанным группам (создайте эти группы в `/etc/group`):

```ruby
AllowGroups webadmins backupadmins
```

Отключите возможность входа с привилегиями `root`. Безопаснее входить в систему с привилегиями рядового пользователя и затем использовать `sudo`:

```ruby
PermitRootLogin no

# Как вариант, можно разрешить вход с привилегиями **root**, но только методом аутентификации с открытым ключом
PermitRootLogin prohibit-password
```

Можно отключить вход с паролем для всех пользователей и разрешить только аутентификацию с открытым ключом:

```ruby
PasswordAuthentication no
```

Можно запретить вход конкретным пользователям, перечислив их имена, имена хостов или IP-адреса. Или разрешить вход ограниченному кругу пользователей, определив параметр `AllowUsers`. Вы можете задействовать оба параметра, но помните при этом, что `DenyUsers` всегда обрабатывается первым.

```ruby
DenyUsers duchess madmax stash@example.com cagney@192.168.10.25
```

Ограничьте время ожидания, пока пользователь введет свои учетные данные и завершит процедуру входа в систему. По умолчанию 120 секунд

```ruby
LoginGraceTime 90
```

Можно также ограничить количество неудачных попыток входа. По умолчанию

```ruby
MaxAuthTries 4
```
