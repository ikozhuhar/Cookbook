### [:diamond_shape_with_a_dot_inside:](#toc) <a name='3'>systemctl</a>

_**Задача:** Перечислить все службы, установленные в системе, и вывести их состояние: запущены они или находятся в состоянии ошибки._

```ruby

# Перечисление всех модулей, активные и неактивные:
sudo systemctl --all

# Сколько всего файлов модулей?
sudo systemctl list-unit-files

# Службы
sudo systemctl list-unit-files --type=service
sudo systemctl list-unit-files --type=service --state=enabled
sudo systemctl list-unit-files --type=service --state=disabled
sudo systemctl list-unit-files --type=service --state=static
sudo systemctl list-unit-files --type=service --state=masked
```


Статус  `enabled` показывает, что служба доступна и управляется системой `systemd`. Когда служба включена, systemd создает символическую ссылку в `/etc/systemd/system/` на файл модуля в `/lib/systemd/system/`. 

Статус `disabled` означает, что в `/etc/systemd/system/` нет символической ссылки, и эта служба не запускается автоматически при загрузке (но ее можно запустить и остановить вручную).

Статус `masked` говорит о том, что служба ссылается на `/dev/null/`. Она полностью отключена, и ее нельзя запустить никаким способом.

Статус `static` означает, что файл модуля является зависимостью для других файлов модуля и не может быть запущен или остановлен пользователем.

Статус `indirect` присваивается службам, которые не предназначены для управления пользователями, но могут управляться другими службами; generated сообщает, что служба была преобразована из конфигурационного файла системы инициализации, отличной от systemd, — SysV init или LSB init.


<br>

_**Задача:** Узнать состояние одной или нескольких конкретных служб._

```ruby
systemctl status cups.service
systemctl status mariadb.service bluetooth.service lm-sensors.service
```
![image](https://github.com/user-attachments/assets/0d73bacf-cd62-411e-bae9-cf9179cf1f73)


Круглый маркер рядом — это индикатор состояния. Он отображается разными цветами. Белый — неактивное состояние. Красный — состояние сбоя или ошибки. Зеленый — служба активна, запускается или перезапускается.

`Loaded` сообщает, загружен ли файл модуля в память и полный путь к нему, текущий статус службы и статус, предопределенный производителем (vendor preset:), который сообщает, должна ли, по мнению производителя, запускаться эта служба во время загрузки. Когда служба выключена, это означает, что по умолчанию производитель не предполагал запускать ее при загрузке. Этот параметр лишь отражает предпочтения производителя и не сообщает, включена ли служба в настоящее время.

`Active` сообщает, активна ли служба и как долго она находится в этом состоянии.

`Process` сообщает идентификаторы PID процессов, команды и имена демонов.

`Main PID` — это номер процесса для сегмента контрольной группы.

`Tasks` сообщает количество задач, запущенных службой. Задачи — это идентификаторы процессов PID.

`CGroup` показывает, к какому сегменту модуля принадлежит служба и его PID. Существует три сегмента модулей по умолчанию: `user.slice`, `system.slice` и `machine.slice`.

Контрольные группы Linux (cgroups) — это наборы связанных процессов и всех их потомков. Сегмент в `systemd` — это часть контрольной группы, и каждый сегмент управляет определенной группой процессов. Запустите `systemctl status`, чтобы увидеть иерархию контрольных групп.  По умолчанию службы и области видимости модулей сгруппированы в `/lib/systemd/system/system.slice`. Пользовательские сеансы сгруппированы в `/lib/systemd/system/user.slice`. Виртуальные машины и контейнеры, зарегистрированные в systemd, сгруппированы в `/lib/systemd/system/machine.slice`.

![image](https://github.com/user-attachments/assets/7eb9765b-e269-41d5-a713-90b24ffdc19f)

```ruby
# Дополнительная информация
man 1 systemctl
man 5 systemd.slice
man 1 journalctl
```

<br>

_**Задача:** Запуск и остановка служб._























